<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Base-10 Addition/Subtraction Stacked</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin:0; padding:0;
  background: #f9f9f9;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
}
h2 { margin:20px; text-align:center; }
#controls {
  margin-bottom: 20px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}
input, button, select { font-size:16px; padding:5px 10px; }
#availableBlocks {
  margin-bottom: 20px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}
.block {
  cursor:pointer;
  user-select:none;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  color:#fff;
  border-radius:4px;
  transition: transform 0.1s;
}
.flat { background:#f06; width:200px; height:200px; }
.rod  { background:#0a0; width:20px; height:200px; }
.unit { background:#06f; width:20px; height:20px; }

#board {
  display:flex;
  gap:20px;
  border:2px solid #333;
  background:#fff;
  padding:20px 10px 60px 10px;
  justify-content:flex-start;
  min-width:90vw;
}
.column {
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  border-left:1px solid #333;
  min-height:240px;
  position:relative;
  flex-wrap: nowrap;
  gap:5px;
  padding-top:30px;
}
.column:first-child { border-left:none; }
.column-label {
  position:absolute;
  top:0;
  width:100%;
  text-align:center;
  font-weight:bold;
}
#equation {
  margin-top:40px;
  font-size:24px;
}
</style>
</head>
<body>

<h2>Base-10 Addition/Subtraction with Regrouping</h2>

<div id="controls">
  <label>Operation:
    <select id="operation">
      <option value="add">Addition</option>
      <option value="subtract">Subtraction</option>
    </select>
  </label>
  <label>Number 1: <input type="number" id="num1" value="267"></label>
  <label>Number 2: <input type="number" id="num2" value="158"></label>
  <button id="setup">Set Up</button>
</div>

<div id="board">
  <div class="column" id="hundredsCol"><div class="column-label">Hundreds</div></div>
  <div class="column" id="tensCol"><div class="column-label">Tens</div></div>
  <div class="column" id="onesCol"><div class="column-label">Ones</div></div>
</div>

<div id="equation">
  ___ + ___ = ___
</div>

<script>
const operationEl = document.getElementById('operation');
const num1El = document.getElementById('num1');
const num2El = document.getElementById('num2');
const setupBtn = document.getElementById('setup');
const hundredsCol = document.getElementById('hundredsCol');
const tensCol = document.getElementById('tensCol');
const onesCol = document.getElementById('onesCol');

let currentRow = 0; // 0 = first number, 1 = second number

// --- Clear board ---
function clearBoard() {
  [hundredsCol, tensCol, onesCol].forEach(col => col.innerHTML = '<div class="column-label">'+col.querySelector('.column-label').innerText+'</div>');
  updateEquation();
}

// --- Update equation ---
function updateEquation(){
  const h = hundredsCol.children.length-1;
  const t = tensCol.children.length-1;
  const o = onesCol.children.length-1;
  const total = h*100 + t*10 + o*1;
  const op = operationEl.value==='add'?'+':'-';
  const result = operationEl.value==='add'? parseInt(num1El.value)+parseInt(num2El.value) : parseInt(num1El.value)-parseInt(num2El.value);
  document.getElementById('equation').innerText = `${num1El.value} ${op} ${num2El.value} = ${total} (Target: ${result})`;
}

// --- Create blocks for number ---
function createBlocksForNumber(num){
  let hundreds = Math.floor(num/100);
  let tens = Math.floor((num%100)/10);
  let ones = num%10;
  for(let i=0;i<hundreds;i++) addBlock('flat', currentRow);
  for(let i=0;i<tens;i++) addBlock('rod', currentRow);
  for(let i=0;i<ones;i++) addBlock('unit', currentRow);
}

// --- Add block ---
function addBlock(type,row){
  const block = document.createElement('div');
  block.classList.add('block', type);
  block.dataset.value = type==='flat'?100:type==='rod'?10:1;
  block.dataset.row = row;
  block.innerText = '';
  block.addEventListener('click', ()=>{
    block.innerText = block.innerText===''?block.dataset.value:'';
  });
  block.addEventListener('mousedown', startDrag);
  block.addEventListener('touchstart', startDrag);
  // Append block
  if(type==='flat') hundredsCol.appendChild(block);
  else if(type==='rod') tensCol.appendChild(block);
  else onesCol.appendChild(block);
  updateEquation();
}

// --- Setup ---
setupBtn.addEventListener('click', ()=>{
  clearBoard();
  currentRow = 0;
  createBlocksForNumber(parseInt(num1El.value));
  currentRow = 1;
  createBlocksForNumber(parseInt(num2El.value));
});

// --- Drag & regroup ---
let dragBlock=null;
let offsetX=0, offsetY=0;

function startDrag(e){
  e.preventDefault();
  dragBlock = e.target;
  const rect = dragBlock.getBoundingClientRect();
  const touch = e.touches ? e.touches[0] : e;
  offsetX = touch.clientX - rect.left;
  offsetY = touch.clientY - rect.top;
  dragBlock.style.position='absolute';
  dragBlock.style.zIndex='1000';
  document.body.appendChild(dragBlock);
  function move(ev){
    const t = ev.touches ? ev.touches[0] : ev;
    dragBlock.style.left = (t.clientX - offsetX)+'px';
    dragBlock.style.top = (t.clientY - offsetY)+'px';
  }
  function up(ev){
    document.removeEventListener('mousemove',move);
    document.removeEventListener('mouseup',up);
    document.removeEventListener('touchmove',move);
    document.removeEventListener('touchend',up);
    regroupBlock(dragBlock);
    dragBlock=null;
  }
  document.addEventListener('mousemove',move);
  document.addEventListener('mouseup',up);
  document.addEventListener('touchmove',move);
  document.addEventListener('touchend',up);
}

// --- Regroup ---
function regroupBlock(block){
  const val = parseInt(block.dataset.value);
  const rect = block.getBoundingClientRect();
  const hRect = hundredsCol.getBoundingClientRect();
  const tRect = tensCol.getBoundingClientRect();
  const oRect = onesCol.getBoundingClientRect();

  // --- Addition regroup ---
  if(operationEl.value==='add'){
    if(val===1 && countBlocks(onesCol,'unit')>=10){
      removeBlocks(onesCol,'unit',10);
      addBlock('rod',0);
    }
    if(val===10 && countBlocks(tensCol,'rod')>=10){
      removeBlocks(tensCol,'rod',10);
      addBlock('flat',0);
    }
  }

  // --- Subtraction regroup ---
  if(operationEl.value==='subtract'){
    if(val===100){
      block.remove();
      for(let i=0;i<10;i++) addBlock('rod',block.dataset.row);
    }
    if(val===10){
      block.remove();
      for(let i=0;i<10;i++) addBlock('unit',block.dataset.row);
    }
  }

  updateEquation();
}

function countBlocks(col,type){
  return Array.from(col.children).filter(b=>b.classList.contains(type)).length;
}

function removeBlocks(col,type,num){
  const blocks = Array.from(col.children).filter(b=>b.classList.contains(type));
  for(let i=0;i<num;i++) blocks[i].remove();
}
</script>

</body>
</html>
